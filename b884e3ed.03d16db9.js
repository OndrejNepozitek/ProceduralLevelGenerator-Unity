(window.webpackJsonp=window.webpackJsonp||[]).push([[122],{179:function(e,o,t){"use strict";t.r(o),t.d(o,"frontMatter",(function(){return l})),t.d(o,"metadata",(function(){return s})),t.d(o,"rightToc",(function(){return d})),t.d(o,"default",(function(){return p}));var n=t(2),r=t(6),a=(t(0),t(241)),i=t(245),l={title:"Adding door tiles"},s={unversionedId:"guides/adding-door-tiles",id:"version-1.0.3/guides/adding-door-tiles",isDocsHomePage:!1,title:"Adding door tiles",description:"We talked about doors when we were designing room templates, but we did not add any actual door tiles. It would be probably more precise to use the term connection instead of door when talking about room templates. The goal of this tutorial is to describe two ways of adding actual door tiles to connections between individual rooms.",source:"@site/versioned_docs\\version-1.0.3\\guides\\adding-door-tiles.md",permalink:"/Edgar-Unity/docs/1.0.3/guides/adding-door-tiles",editUrl:"https://github.com/OndrejNepozitek/Edgar-Unity/tree/docusaurus/versioned_docs/version-1.0.3/guides/adding-door-tiles.md",version:"1.0.3",sidebar:"version-1.0.3/docs",previous:{title:"Payload initializer",permalink:"/Edgar-Unity/docs/1.0.3/pipeline-tasks/payload-initializer"},next:{title:"Procedural level graphs",permalink:"/Edgar-Unity/docs/1.0.3/guides/procedural-level-graphs"}},d=[{value:"Adding door tiles to room templates",id:"adding-door-tiles-to-room-templates",children:[]},{value:"Adding door tiles via a pipeline task",id:"adding-door-tiles-via-a-pipeline-task",children:[]}],c={rightToc:d};function p(e){var o=e.components,t=Object(r.a)(e,["components"]);return Object(a.b)("wrapper",Object(n.a)({},c,t,{components:o,mdxType:"MDXLayout"}),Object(a.b)("p",null,"We talked about doors when we were designing room templates, but we did not add any actual door tiles. It would be probably more precise to use the term ",Object(a.b)("em",{parentName:"p"},"connection")," instead of ",Object(a.b)("em",{parentName:"p"},"door")," when talking about room templates. The goal of this tutorial is to describe two ways of adding actual door tiles to connections between individual rooms."),Object(a.b)("p",null,"For this tutorial, we will use the tileset from ",Object(a.b)("a",Object(n.a)({parentName:"p"},{href:"example1.md"}),"Example 1"),". This tileset provides tiles to make doors with lengths of 1 or 2 tiles. Below you can seen an example of both possible lengths of doors."),Object(a.b)(i.a,{cols:2,fixedHeight:!0,mdxType:"Gallery"},Object(a.b)(i.b,{src:"img/original/adding_door_tiles_before.png",caption:"Before",mdxType:"GalleryImage"}),Object(a.b)(i.b,{src:"img/original/adding_door_tiles_after.png",caption:"After",mdxType:"GalleryImage"})),Object(a.b)("h2",{id:"adding-door-tiles-to-room-templates"},"Adding door tiles to room templates"),Object(a.b)("p",null,"In some simple situations, we can add door tiles directly to our room templates. However, we cannot add them to all room templates as we do not know beforehand which door positions will be used by the algorithm. But we can add them to our corridor room templates because there will be usually exactly two available door positions. You can see below how would that look like."),Object(a.b)(i.a,{cols:2,fixedHeight:!0,mdxType:"Gallery"},Object(a.b)(i.b,{src:"img/original/corridor_with_doors_hor.png",caption:"Horizontal corridor",mdxType:"GalleryImage"}),Object(a.b)(i.b,{src:"img/original/corridor_with_doors_ver.png",caption:"Vertical corridor",mdxType:"GalleryImage"})),Object(a.b)("p",null,"This will work only if we have corridors enabled and we want to have door tiles placed on all used door positions."),Object(a.b)("h2",{id:"adding-door-tiles-via-a-pipeline-task"},"Adding door tiles via a pipeline task"),Object(a.b)("p",null,"First we have somehow to get all the door tiles that we need. We can either hardcode the paths to individual tile assets or we can do it through the editor. I think that the latter approach is better because we can reuse the task for a different tileset and we can also easily swap the tiles without changing the code. The task config looks like this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(n.a)({parentName:"pre"},{className:"language-csharp"}),'[CreateAssetMenu(menuName = "Dungeon generator/Examples/Example 1/Doors task", fileName = "DoorsTask")]\npublic class DoorsConfig : PipelineConfig\n{\n    public bool AddDoors;\n\n    public TileBase HorizontalLeft;\n\n    public TileBase HorizontalRight;\n\n    public TileBase VerticalTop;\n\n    public TileBase VerticalBottom;\n}\n')),Object(a.b)("p",null,"You can see that I also added the ",Object(a.b)("em",{parentName:"p"},"AddDoors")," property to easily enable and disable the functionality. No we are going to write the actual logic. The basic structure looks like this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(n.a)({parentName:"pre"},{className:"language-csharp"}),"public class DoorsTask<TPayload> : ConfigurablePipelineTask<TPayload, DoorsConfig> \n    where TPayload : class\n{\n    public override void Process()\n    {\n        if (!Config.AddDoors)\n        {\n            return;\n        }\n\n        // Add door tiles\n    }\n}\n")),Object(a.b)("p",null,"And the result looks like this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(n.a)({parentName:"pre"},{className:"language-csharp"}),"public class DoorsTask<TPayload> : ConfigurablePipelineTask<TPayload, DoorsConfig> \n    where TPayload : class, IGeneratorPayload, IGraphBasedGeneratorPayload, INamedTilemapsPayload\n{\n    public override void Process()\n    {\n        if (!Config.AddDoors)\n        {\n            return;\n        }\n\n        // Iterate through all rooms\n        foreach (var pair in Payload.LayoutData)\n        {\n            var roomInfo = pair.Value;\n\n            // Check if corridor room\n            if (roomInfo.IsCorridor)\n            {\n                // Iterate through all used door positons\n                foreach (var doorInfo in roomInfo.Doors)\n                {\n                    // We cannot handle doors with length > 2\n                    if (doorInfo.DoorLine.Length > 2)\n                    {\n                        continue;\n                    }\n\n                    if (doorInfo.IsHorizontal)\n                    {\n                        AddHorizontalDoors(doorInfo);\n                    }\n                    else\n                    {\n                        AddVerticalDoors(doorInfo);\n                    }\n                }\n            }\n        }\n    }\n\n    protected void AddHorizontalDoors(DoorInfo<Room> doorInfo)\n    {\n        Payload.CollideableTilemap.SetTile(doorInfo.DoorLine.GetNthPoint(0), Config.HorizontalLeft);\n\n        if (doorInfo.DoorLine.Length > 1)\n        {\n            Payload.CollideableTilemap.SetTile(doorInfo.DoorLine.GetNthPoint(1), Config.HorizontalRight);\n        }\n    }\n\n    protected void AddVerticalDoors(DoorInfo<Room> doorInfo)\n    {\n        Payload.CollideableTilemap.SetTile(doorInfo.DoorLine.GetNthPoint(0), Config.VerticalBottom);\n\n        if (doorInfo.DoorLine.Length > 1)\n        {\n            Payload.CollideableTilemap.SetTile(doorInfo.DoorLine.GetNthPoint(1), Config.VerticalTop);\n        }\n    }\n}\n")),Object(a.b)("p",null,"The code should be quite self-explaining."),Object(a.b)("blockquote",null,Object(a.b)("p",{parentName:"blockquote"},Object(a.b)("strong",{parentName:"p"},"Note:"),": We add doors to the ",Object(a.b)("em",{parentName:"p"},"Collideable")," tilemap layer and we use the ",Object(a.b)("em",{parentName:"p"},"INamedTilemapsPayload")," to access the tilemap by its name rather than by its index.")),Object(a.b)("p",null,"This approach is very flexible as we can control where exactly we want to add doors. For example, we can add door tiles only to randomly chosen door position. The code would look like this:"),Object(a.b)("pre",null,Object(a.b)("code",Object(n.a)({parentName:"pre"},{className:"language-csharp"}),'[CreateAssetMenu(menuName = "Dungeon generator/Examples/Example 1/Doors task", fileName = "DoorsTask")]\npublic class DoorsConfig : PipelineConfig\n{\n    // Basic properties here\n\n    [Range(0f, 1f)]\n    public float Probability = 1;\n}\n\npublic class DoorsTask<TPayload> : ConfigurablePipelineTask<TPayload, DoorsConfig> \n    where TPayload : class, IGeneratorPayload, IGraphBasedGeneratorPayload, INamedTilemapsPayload, IRandomGeneratorPayload\n{\n    public override void Process()\n    {\n        if (!Config.AddDoors)\n        {\n            return;\n        }\n\n        // Iterate through all rooms\n        foreach (var pair in Payload.LayoutData)\n        {\n            var roomInfo = pair.Value;\n\n            // Check if corridor room\n            if (roomInfo.IsCorridor)\n            {\n                if (Payload.Random.NextDouble() < Config.Probability)\n                {\n                    // Add doors\n                }\n            }\n        }\n    }\n}\n')))}p.isMDXComponent=!0},241:function(e,o,t){"use strict";t.d(o,"a",(function(){return p})),t.d(o,"b",(function(){return m}));var n=t(0),r=t.n(n);function a(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function i(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?i(Object(t),!0).forEach((function(o){a(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function s(e,o){if(null==e)return{};var t,n,r=function(e,o){if(null==e)return{};var t,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)t=a[n],o.indexOf(t)>=0||(r[t]=e[t]);return r}(e,o);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)t=a[n],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var d=r.a.createContext({}),c=function(e){var o=r.a.useContext(d),t=o;return e&&(t="function"==typeof e?e(o):l(l({},o),e)),t},p=function(e){var o=c(e.components);return r.a.createElement(d.Provider,{value:o},e.children)},u={inlineCode:"code",wrapper:function(e){var o=e.children;return r.a.createElement(r.a.Fragment,{},o)}},b=r.a.forwardRef((function(e,o){var t=e.components,n=e.mdxType,a=e.originalType,i=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),p=c(t),b=n,m=p["".concat(i,".").concat(b)]||p[b]||u[b]||a;return t?r.a.createElement(m,l(l({ref:o},d),{},{components:t})):r.a.createElement(m,l({ref:o},d))}));function m(e,o){var t=arguments,n=o&&o.mdxType;if("string"==typeof e||n){var a=t.length,i=new Array(a);i[0]=b;var l={};for(var s in o)hasOwnProperty.call(o,s)&&(l[s]=o[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,i[1]=l;for(var d=2;d<a;d++)i[d]=t[d];return r.a.createElement.apply(null,i)}return r.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"},242:function(e,o,t){"use strict";t.d(o,"b",(function(){return a})),t.d(o,"a",(function(){return i}));var n=t(244),r=t(243);function a(){const{siteConfig:{baseUrl:e="/",url:o}={}}=Object(n.a)();return{withBaseUrl:(t,n)=>function(e,o,t,{forcePrependBaseUrl:n=!1,absolute:a=!1}={}){if(!t)return t;if(t.startsWith("#"))return t;if(Object(r.b)(t))return t;if(n)return o+t;const i=!t.startsWith(o)?o+t.replace(/^\//,""):t;return a?e+i:i}(o,e,t,n)}}function i(e,o={}){const{withBaseUrl:t}=a();return t(e,o)}},243:function(e,o,t){"use strict";function n(e){return!0===/^(\w*:|\/\/)/.test(e)}function r(e){return void 0!==e&&!n(e)}t.d(o,"b",(function(){return n})),t.d(o,"a",(function(){return r}))},244:function(e,o,t){"use strict";var n=t(0),r=t(20);o.a=function(){const e=Object(n.useContext)(r.a);if(null===e)throw new Error("Docusaurus context not provided");return e}},245:function(e,o,t){"use strict";t.d(o,"a",(function(){return s})),t.d(o,"b",(function(){return d})),t.d(o,"c",(function(){return p}));var n=t(2),r=t(0),a=t.n(r),i=t(242);const l=e=>a.a.createElement("div",{style:{display:"inline-block",margin:2,overflow:"hidden",position:"relative",width:`calc(${100/e.cols}% - 4px)`,verticalAlign:"top"}},e.children),s=e=>a.a.createElement("div",{style:{fontSize:"0px",margin:"20px 0"}},a.a.Children.map(e.children,o=>a.a.cloneElement(o,{cols:e.cols||4,fixedHeight:e.fixedHeight}))),d=e=>a.a.createElement(l,{cols:e.cols},a.a.createElement("a",{href:Object(i.a)(e.src),target:"_blank"},a.a.createElement("img",{src:Object(i.a)(e.src),alt:"result",style:{height:!0===e.fixedHeight?800/e.cols+"px":"auto",objectFit:!0===e.fixedHeight?"cover":"initial"}})),void 0!==e.caption&&a.a.createElement(c,null,e.caption)),c=e=>a.a.createElement("div",{style:{fontSize:16,fontStyle:"italic",textAlign:"center",margin:"10px 0px 15px"}},e.children),p=e=>{const{src:o,caption:t,...r}=e;return a.a.createElement("div",{style:{textAlign:"center"}},a.a.createElement("img",Object(n.a)({src:Object(i.a)(e.src)},r)),void 0!==e.caption&&a.a.createElement(c,null,e.caption))}}}]);